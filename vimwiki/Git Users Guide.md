# Using Git 
## Conventions and guidelines 
### GIT
Git is a standalone repository. Unlike SVN where there's a central code repository, each git is a standalone repository. With the ability
to communicate with any other repository.
#### Folder Structure
For Smart-IT each Version of odoo will have 4 repositories associated with it. For Version 12 for example this will be:
- odoo-12-addons-smart : Contains only addons developed purely by smart it.
- odoo-12-addons-more : Contains only addons developer by third part developers.
- odoo-12-enterprise : Contains all enterprise modules.
- odoo-12-smart : Contains the cut version of Odoo 12

### MASTER
Master is the live copy and should never be worked on or against. Only release cuts from staging should ever be merged into MASTER.

**We never ever touch MASTER itself, we develop against the staging branch only.**

### STAGING
Staging is a branch of MASTER. This is the branch where we will work against and where feature branches or patches will be merged
with.

### FEATURE BRANCH
This is the start of any bug fix or development. It's a separate branch where the development of any feature will be commit into.

### PATCHES
Are single files that git can integrate into a code change. Usually used for bug fixes developed by the third party developers.

### BRANCHING NAMING CONVENTION
**Every development should have a reference to a PID or a helpdesk ticket**
#### Feature Branches
For this we will use the name of the project, the PID id and then feature id listed in the PID.
For example if we had to develop a feature for abdotcom (maxxipaws), which is described in PID 123 and it's line 1.2 in the pid. We would
name the branch:
- AB123-1.2
  - AB (project name abbreviaition)
  - 123 (Pid id)
  - 1.2 (Feature line in Pid)

#### Bug fix Branches
For bug fixes we would take the project name abbreviation and then the bug ticket number.
For example if the had a helpdesk ticket from abdotcom (maxxipaws) We would name the branch:
- AB#29
  - AB (project name abbreviation)
  - #29 (ticket number)

### Commit Message Guidelines
```
Short (72 chars or less) summary

More detailed explanatory text. Wrap it to 72 characters. The blank
line separating the summary from the body is critical (unless you omit
the body entirely).

Write your commit message in the imperative: "Fix bug" and not "Fixed
bug" or "Fixes bug." This convention matches up with commit messages
generated by commands like git merge and git revert.

Further paragraphs come after blank lines.

- Bullet points are okay, too.
- Typically a hyphen or asterisk is used for the bullet, followed by a
  single space. Use a hanging indent.
  ```

  #### Example for a commit message
  ```
  Add CPU arch filter scheduler support

  In a mixed environment of…
  ```

  #### A properly formed git commit subject line should always be able to complete the following sentence
  If applied, this commit will *\<your subject line here\>*

  #### Rules for a great git commit message style
  * Separate subject from body with a blank line
  * Do not end the subject line with a period
  * Capitalise the subject line and each paragraph
  * Use the imperative mood in the subject line
  * Wrap lines at 72 characters
  * Use the body to explain what and why you have done something. In most cases, you can leave out details about how a change has been
    made.

    ### Information in commit messages
    * Describe why a change is being made.
    * How does it address the issue?
    * What effects does the patch have?
    * Do not assume the reviewer understands what the original problem was.
    * Do not assume the code is self-evident/self-documenting.
    * Read the commit message to see if it hints at improved code structure.
    * The first commit line is the most important.
    * Describe any limitations of the current code.
    * Do not include patch set-specific comments.

    Details for each point and good commit message examples can be found on
    https://wiki.openstack.org/wiki/GitCommitMessages#Information_in_commit_messages

    ### References in commit messages
    If the commit refers to an issue, add this information to the commit message header or body. e.g. the GitHub web platform automatically
    converts issue ids (e.g. #123) to links referring to the related issue. For issues tracker like Jira there are plugins which also
    converts Jira tickets, e.g. [Jirafy](https://chrome.google.com/webstore/detail/jirafy/npldkpkhkmpnfhpmeoahhakbgcldplbj).

    In header:
    ```
    [#123] Refer to GitHub issue…
    ```
    ```
    CAT-123 Refer to Jira ticket with project identifier CAT…
    ```
    In body:
    ```
    …
    Fixes #123, #124
    ```



## How do we start for Smart IT. Assuming we start fresh.
### Linux
Before we start with Linux, make sure you're ssh key had been added to trusted users on GitHub.
Steps for this can be found here : https://help.github.com/en/articles/adding-a-new-ssh-key-to-your-github-account

We'll need to create 1 main folder called 'odoo-12', we then jump into that folder on the command line and type.

```bash shell
git clone git@github.com:Smart-IT-Kirkham/odoo_12_addons_ent.git
```
Change out the git@github link with the appropriate link, you cen get the link from the repo on github.

### Windows
You can install any of the gui clients available for GIT and do the same. For this example I'll use
https://desktop.github.com/ which is the github native desktop client. Once you've installed the application and logged in, (it will ask
your github login credentials) you can choose to Clone a remote repository.

![Alt](/git-0.PNG "Screenshot0")

After selecting clone you can select which repository to clone as well as where to clone it to.

![Alt](/git-1.PNG "Screenshot0")
![Alt](/git-2.PNG "Screenshot0")

Of course don't forget to make the needed changes to addons folder structure in your odoo.conf as per the directory structure you want to
use. Github is configured to set staging as the default branch. So when you pull in, you'll see that staging is set as the repository
you'll work against. Except for Odoo-12 or Enterprise repositories at the moment.

![Alt](/git-3.PNG "Screenshot0")

**Make sure you're never working against master**

## Lets create a branch for a new feature or a bug fix

First we need to create a new branch and apply the correct naming convention.

### Linux
```bash
git checkout -b AB123-1.2
  Switched to a new branch 'AB123-1.2'
```

We can check with
```bash
git branch
  * AB123-1.2
    staging
```

### Windows

![Alt](/git-4.PNG "Screenshot0")
![Alt](/git-5.PNG "Screenshot0")

You can publish your new branch which means you'll push the branch into the remote repository at github.com. This assures no one else could
take your branch name and it also assures that anyone else can work on the same feature branch.

### Linux

```bash
git push --set-upstream origin AB123-1.2
  Enter passphrase for key '/home/edwin/.ssh/id_rsa':
  Total 0 (delta 0), reused 0 (delta 0)
  remote:
  remote: Create a pull request for 'AB123-1.2' on GitHub by visiting:
  remote:      https://github.com/Smart-IT-Kirkham/odoo_12_addons_smart/pull/new/AB123-1.2
  remote:
  To github.com:Smart-IT-Kirkham/odoo_12_addons_smart.git
   * [new branch]      AB123-1.2 -> AB123-1.2
   * Branch 'AB123-1.2' set up to track remote branch 'AB123-1.2' from 'origin'.
```

### Windows

Simply click the button.

![Alt](/git-6.PNG "Screenshot0")


## Now we're ready for some actual coding

Once we've done that we can start developing our current feature and start making some changes.
For this example I'll simply modify the README.MD file by adding another line.

### Linux
After modifying the file(s) we can check what has been changed, add the changes and commit with a description.

Check the status
```bash
git status
  On branch AB123-1.2
  Your branch is up to date with 'origin/AB123-1.2'.
  
  Changes not staged for commit:
    (use "git add <file>..." to update what will be committed)
      (use "git checkout -- <file>..." to discard changes in working directory)
      
              modified:   README.MD
              
              no changes added to commit (use "git add" and/or "git commit -a")
```


Add the changes to the commit.
```bash
git add .
```

Commit the changes 
```bash
git commit -m "Altered the file to add another line describing how good it would be to use this file for documentation."
[AB123-1.2 8626b87] Altered the file to add another line describing how good it would be to use this file for documentation.
  Committer: Edwin Blommaerts <edwin@SIT-LAP-EB.smart.local>
             1 file changed, 1 insertion(+)
```

### Windows
The windows apps shows us the changes that have been done and which files have been changed as soon as you save your changes.

![Alt](/git-7.PNG "Screenshot0")

Once you're ready to commit your changes, fill in the Description and remark box and press Commit.

![Alt](/git-8.PNG "Screenshot0")

## Finally lets push our changes to the remote repository

### Linux
Run the following command to push your changes to the remote/upstream repository.
```bash
git push
  Counting objects: 3, done.
  Delta compression using up to 4 threads.
  Compressing objects: 100% (3/3), done.
  Writing objects: 100% (3/3), 414 bytes | 414.00 KiB/s, done.
  Total 3 (delta 1), reused 0 (delta 0)
  remote: Resolving deltas: 100% (1/1), completed with 1 local object.
  To github.com:Smart-IT-Kirkham/odoo_12_addons_smart.git
     24856fb..8626b87  AB123-1.2 -> AB123-1.2
```

### Windows
This is as simple as pushing the publish origin button.

![Alt](/git-9.PNG "Screenshot0")

## I've finished all development and would like my branch to be merged into staging for testing.

For this we'll use pull requests, there's some commands for this but it's easier to do it through the github interface. So we'll go to the
github interface and click the button **Compare & pull request**. 

![Alt](/git-10.PNG "Screenshot0")

After that we can fill in some remarks and comments about this pull request as well as ask for code review.

![Alt](/git-11.PNG "Screenshot0")

The reviewer can then leave comments and/or approve the changes!

![Alt](/git-12.PNG "Screenshot0")

Once the changes have been merged into staging the feature or bug fix can be tested internally or be provided to the user for UAT testing
before deploying the changes to master.

## Sprint finished, lets do a release!

First we need to merge staging with all the merged feature branches into Master.
This can again easily be done through the github interface.

![Alt](/git-13.PNG "Screenshot0")

After this has been merged we can tag the current master code with a release number.
By going to the repository and then clicking release.

![Alt](/git-15.PNG "Screenshot0")

We then fill in the version number tag and number associated with the release.

![Alt](/git-16.PNG "Screenshot0")

**And DONE!**

![Alt](/git-17.PNG "Screenshot0")

We've now got a release which we could deploy using folders or we could simply go to our servers and pull in the code from master.
If anything goes wrong in subsequent releases we could simply revert the changes or if it's beyond repair we could use these files to
deploy a roll back.

## But what if not all features passed testing?

The above scenario assumes everyone finished their development on time for the release and it passes all tests.
But what do we do when that's not the case? 

This means we need to cut a release branch and merge only the feature branches or bug fixes in that we want to release.
So we cut a branch from master, merge the feature branches that have been tested and approved for release into this new branch and finally
merge this release branch back into master.

## Want to make sense of it in a graphical manner?

I used the command:

```
git log --graph

```
The output of this is the following :
```
commit fac187f5080bfaae585c56c470c006ba281b8b01 (HEAD -> staging, origin/staging, origin/HEAD)
|\  Merge: 395cb82 8e2bc37
| | Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| | Date:   Tue Mar 5 22:27:52 2019 +0000
| |
| |     Merge pull request #7 from Smart-IT-Kirkham/master
| |
| |     Merge pull request #6 from Smart-IT-Kirkham/Release-branch-V1.0.2
| |
| *   commit 8e2bc37e26f37680d95752576cfc448555100931
| |\  Merge: 96dfdc6 7018868
| | | Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| | | Date:   Tue Mar 5 22:18:46 2019 +0000
| | |
| | |     Merge pull request #6 from Smart-IT-Kirkham/Release-branch-V1.0.2
| | |
| | |     Release branch v1.0.2
| | |
* | |   commit 395cb8260f39d346c1126f9843e22e8522abde59 (tag: v1.0.2)
|\ \ \  Merge: 2eed7cf 7018868
| | |/  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| |/|   Date:   Tue Mar 5 21:49:48 2019 +0000
| | |
| | |       Merge pull request #5 from Smart-IT-Kirkham/AB123-1.3
| | |
| | |       Update README.MD
| | |
| * |   commit 7018868591f250aa272ab7ffcd424bb2db3c4ab2 (origin/Release-branch-V1.0.2, origin/AB123-1.3)
| |\ \  Merge: 40ef245 2eed7cf
| |/ /  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
|/| |   Date:   Tue Mar 5 21:42:01 2019 +0000
| | |
| | |       Merge branch 'staging' into AB123-1.3
| | |
* | |   commit 2eed7cf357a782c877ece6e770e66aebc645a139
|\ \ \  Merge: a50c14e 22ec4b0
| | | | Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| | | | Date:   Tue Mar 5 21:39:57 2019 +0000
| | | |
| | | |     Merge pull request #4 from Smart-IT-Kirkham/AB123-1.4
| | | |
| | | |     Update README.MD
| | | |
| * | | commit 22ec4b0fc9f0ae408f2da827f3b97d82e18a6951 (origin/AB123-1.4)
|/ / /  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| | |   Date:   Tue Mar 5 21:35:45 2019 +0000
| | |
| | |       Update README.MD
| | |
| | |       Updated Readme again
| | |
| * | commit 40ef2458d46464e410efd0baa8856efb3570e81f
|/ /  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| |   Date:   Tue Mar 5 21:37:53 2019 +0000
| |
| |       Update README.MD
| |
| |       Another test commit
| |
* |   commit a50c14eb61bf5a4af80910b52717ac2269b6ee24
|\ \  Merge: a191a1e 96dfdc6
| |/  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| |   Date:   Tue Mar 5 17:02:26 2019 +0000
| |
| |       Merge pull request #3 from Smart-IT-Kirkham/master
| |
| |       Merge pull request #2 from Smart-IT-Kirkham/staging
| |
| *   commit 96dfdc6d12b181bd3499dfb8ab740b66370a25f2 (tag: v1.0.1)
| |\  Merge: fecd986 a191a1e
| |/  Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
|/|   Date:   Tue Mar 5 16:58:33 2019 +0000
| |
| |       Merge pull request #2 from Smart-IT-Kirkham/staging
| |
| |       Master merge release
| |
| commit a191a1ec5c18c4773db2fdf66088febf1a992c00
| | Author: Blommaerts Edwin <edwin.blommaerts@gmail.com>
| | Date:   Tue Mar 5 16:31:28 2019 +0000
| |
| |     Update README.MD
| |
```

Or use Tortoise or any other tool to give you a graphical presentation of the merging tree.

![Alt](/git-18.PNG "Screenshot0")

